import pandas as pd
import matplotlib.pyplot as plt

# 读取数据文件
file_path = 'ResaleflatpricesbasedonregistrationdatefromJan2017onwards.csv'
data = pd.read_csv(file_path)

# 转换 'month' 列为日期格式
data['month'] = pd.to_datetime(data['month'], format='%Y-%m')

# 筛选最近六个月的数据
latest_date = data['month'].max()
six_months_ago = latest_date - pd.DateOffset(months=6)
recent_data = data[data['month'] > six_months_ago]

# 按 'town' 分组计算销售量和总成交额
sales_summary = recent_data.groupby('town').agg({'resale_price': ['count', 'sum']})
sales_summary.columns = ['sales_count', 'total_resale_value']
sales_summary = sales_summary.sort_values(by='sales_count', ascending=False)

# 绘制柱状图
plt.figure(figsize=(12, 6))
sales_summary['sales_count'].plot(kind='bar', color='skyblue', edgecolor='black')
plt.title('Number of Houses Sold by Town (Last 6 Months)', fontsize=16)
plt.ylabel('Number of Houses Sold', fontsize=12)
plt.xlabel('Town', fontsize=12)
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()
